name: CI/CD

on:
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - name: List files in android directory
        run: ls -l android
      - name: Install dependencies
        run: yarn install
      - name: Run tests
        run: yarn test
      - name: Ingresar a la carpeta android
        run: cd android
      - name: Grant execute permission for gradlew
        run: chmod g+x gradlew gradlew.bat
      - name: Build Android APK
        run: ./gradlew assembleRelease
      - name: Upload APK as artifact
        uses: actions/upload-artifact@v3
        with:
          name: app-release
          path: android/app/build/outputs/apk/release/app-release.apk
    # - name: Send email notification
    #   uses: dawidd6/action-send-mail@v3
    #   with:
    #     server_address: smtp.sendgrid.net
    #     server_port: 587
    #     username: apikey
    #     password: ${{ secrets.SENDGRID_API_KEY }}
    #     subject: Nueva versión de la app disponible
    #     body: La nueva versión de la app está disponible para descargar: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
    #     to: correo1@example.com, correo2@example.com
